<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Asignaciones para las reuniones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.2);
      --accent-strong: #facc15;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: rgba(148, 163, 184, 0.4);
      --radius-xl: 20px;
      --radius-md: 14px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(56, 189, 248, 0.25), transparent 55%),
        radial-gradient(circle at bottom, rgba(250, 204, 21, 0.18), transparent 55%),
        linear-gradient(135deg, #020617, #020617 40%, #020617);
      color: var(--text);
      padding: 1.5rem;
      display: flex;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 960px;
    }

    header {
      text-align: center;
      margin-bottom: 1.4rem;
    }

    header h1 {
      font-size: clamp(2.1rem, 5vw, 2.7rem);
      letter-spacing: 0.03em;
      font-weight: 700;
      color: #f9fafb;
      text-shadow: 0 0 22px rgba(15, 23, 42, 0.9);
      line-height: 1.15;
    }

    .pill-bar {
      display: inline-flex;
      align-items: center;
      gap: 0.55rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      margin-top: 0.7rem;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
    }

    .card-shell {
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.1), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.95), #020617);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 1.25rem 1.1rem 1.35rem;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.15), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .card-shell-inner {
      position: relative;
      z-index: 1;
    }

    .section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.6rem;
      gap: 0.75rem;
    }

    .section-title h2 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
      font-weight: 600;
    }

    .section-title span {
      font-size: 0.9rem;
      color: var(--muted);
      padding: 0.15rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      white-space: nowrap;
    }

    .assignments-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
        gap: 1rem;
      max-height: calc(100vh - 230px);
      overflow-y: auto;
      padding-right: 0.35rem;
    }

    .assignments-grid::-webkit-scrollbar {
      width: 6px;
    }

    .assignments-grid::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 999px;
    }

    .assignments-grid::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.9);
      border-radius: 999px;
    }

    .assignment-card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.99));
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 0.85rem 0.8rem 0.8rem;
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 2.1fr);
      gap: 0.4rem 1.1rem;
      position: relative;
    }

    /* tarjeta destacada (próxima reunión) - fija arriba al hacer scroll */
.assignment-card.destacada {
  border-color: rgba(56, 189, 248, 0.9);
  box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
  position: sticky;
  top: 0;
  z-index: 2;
}

    .assignment-date {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      font-size: 0.95rem;
    }

    .assignment-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
    }

    .assignment-day {
      font-size: 1.05rem;
      font-weight: 700;
      color: #f9fafb;
    }

    .assignment-day.church-day {
      color: var(--accent-strong);
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.25rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.2rem 0.8rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 0.78rem;
      color: var(--muted);
      width: fit-content;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.9);
    }

    .badge-hoy {
      border-color: #22c55e;
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.22);
    }

    .badge-hoy .badge-dot {
      background: #22c55e;
      box-shadow: 0 0 12px rgba(22, 163, 74, 0.9);
    }

    .assignment-details {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.3rem 0.9rem;
      font-size: 0.9rem;
    }

    .detail-group {
      display: flex;
      flex-direction: column;
      gap: 0.05rem;
    }

    .detail-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--muted);
      position: relative;
      padding-left: 1rem;
    }

    .detail-label::before {
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--muted);
    }

    .detail-label.label-audio::before {
      background: #38bdf8;
    }

    .detail-label.label-video::before {
      background: #a78bfa;
    }

    .detail-label.label-mic::before {
      background: #4ade80;
    }

    .detail-label.label-plataforma::before {
      background: #facc15;
    }

    .detail-label.label-entrada::before {
      background: #fb923c;
    }

    .detail-label.label-auditorio::before {
      background: #fb7185;
    }

    .detail-value {
      font-size: 0.96rem;
      color: #e5e7eb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .empty-msg {
      font-size: 0.95rem;
      color: var(--muted);
      padding-top: 0.5rem;
    }

    /* Ajustes generales para pantallas medianas (tablet, etc.) */
@media (max-width: 900px) {
  body {
    padding: 1rem 0.7rem 1.2rem;
  }
}

/* Ajustes especiales para celular */
@media (max-width: 640px) {
  body {
    padding: 0.8rem 0.4rem 1.2rem;
  }

  /* Título más grande en móvil */
  header h1 {
    font-size: 1.7rem;
    line-height: 1.2;
  }

  .card-shell {
    padding: 0.9rem 0.8rem 1rem;
  }

  /* Quitar scroll interno y dejar un solo scroll general */
  .assignments-grid {
    max-height: none;
    overflow-y: visible;
    padding-right: 0;
  }

  /* Reuniones en una sola columna para que se lea mejor */
  .assignment-card {
    grid-template-columns: minmax(0, 1fr);
    padding: 0.9rem 0.85rem;
  }

  .assignment-details {
    grid-template-columns: minmax(0, 1fr);
    row-gap: 0.35rem;
  }

  /* Texto un poco más grande */
  .assignment-day {
    font-size: 1.05rem;
  }

  .detail-label {
    font-size: 0.7rem;
  }

  .detail-value {
    font-size: 0.9rem;
  }
}
/* Controles superiores (selector de mes/año) */
.top-controls {
  margin-top: 0.9rem;
  display: flex;
  gap: 0.75rem;
  justify-content: center;
  flex-wrap: wrap;
}

.top-controls .control {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  font-size: 0.8rem;
  color: var(--muted);
}

#month-select {
  background: rgba(15, 23, 42, 0.9);
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.6);
  padding: 0.35rem 0.9rem;
  color: var(--text);
  font-size: 0.85rem;
  outline: none;
  min-width: 170px;
}

/* En celular que no quede gigante */
@media (max-width: 640px) {
  .top-controls {
    align-items: stretch;
  }

  .top-controls .control {
    width: 100%;
    max-width: 320px;
  }

  #month-select {
    width: 100%;
  }
}
  </style>
</head>
<body>
  <main class="page">
  <header>
    <h1>Asignaciones para las reuniones</h1>

    <div class="pill-bar">
      <span class="pill-dot"></span>
      <span>Conectado a hoja de cálculo · Actualización automática</span>
    </div>

    <!-- Selector de mes/año para V3 -->
    <div class="top-controls">
      <div class="control">
        <label for="month-select">Mes / año</label>
        <select id="month-select"></select>
      </div>
    </div>
  </header>

    <section class="layout">
      <section class="card-shell">
        <div class="card-shell-inner">
          <div class="section-title">
            <h2>Próximas reuniones</h2>
            <span id="count-resumen">Cargando…</span>
          </div>

          <div id="assignments" class="assignments-grid"></div>
        </div>
      </section>
    </section>
  </main>

  <script>
  // ==== CONFIGURACIÓN DE HOJAS (ACÁ AGREGÁS 2026 DESPUÉS) ====
  const SHEETS = {
    "2025-12": {
      label: "Diciembre 2025",
      url: "https://docs.google.com/spreadsheets/d/1v0ZUvpB5vE0_e8QL7ZdxXJOsvr6RTrIjBZcjRjdh44E/export?format=csv&gid=96081337"
    }
    // Ejemplo para el futuro:
    // "2026-01": {
    //   label: "Enero 2026",
    //   url: "URL_CSV_DE_ENERO_2026"
    // }
  };

  let currentSheetKey = "2025-12";

  // Meses en español para leer "Viernes 5 de diciembre"
  const MESES = {
    enero: 0, febrero: 1, marzo: 2, abril: 3, mayo: 4, junio: 5,
    julio: 6, agosto: 7, septiembre: 8, setiembre: 8, octubre: 9,
    noviembre: 10, diciembre: 11
  };

  // --- Utilidad: parsear CSV con comillas ---
  function parseCSV(text) {
    const rows = text.trim().split(/\r?\n/);
    return rows.map(row => {
      const cells = [];
      let actual = "";
      let dentroComillas = false;

      for (let i = 0; i < row.length; i++) {
        const c = row[i];
        if (c === '"') {
          if (dentroComillas && row[i + 1] === '"') {
            actual += '"';
            i++;
          } else {
            dentroComillas = !dentroComillas;
          }
        } else if (c === "," && !dentroComillas) {
          cells.push(actual);
          actual = "";
        } else {
          actual += c;
        }
      }
      cells.push(actual);
      return cells;
    });
  }

  // Domingo = reunión principal
  function esDiaImportante(fechaTexto) {
    if (!fechaTexto) return false;
    const f = fechaTexto.toLowerCase();
    return f.includes("domingo") || f.includes("sábado") || f.includes("sabado");
  }

  // Pasar "Viernes 5 de diciembre" a objeto Date
  function parseFechaDesdeTexto(fechaTexto) {
    if (!fechaTexto) return null;
    const limpio = fechaTexto.toLowerCase().replace(/,/g, "");
    const partes = limpio.split(/\s+/);
    const indiceNumero = partes.findIndex(p => /^\d+$/.test(p));
    if (indiceNumero === -1 || indiceNumero + 1 >= partes.length) return null;

    const dia = parseInt(partes[indiceNumero], 10);
    const mesNombre = partes[indiceNumero + 2] || partes[indiceNumero + 1];
    const mes = MESES[mesNombre];
    if (mes == null) return null;

    const [anioStr] = currentSheetKey.split("-");
    const anio = parseInt(anioStr, 10) || (new Date()).getFullYear();
    return new Date(anio, mes, dia);
  }

  // Selector de mes / año
  function initMonthSelect() {
    const select = document.getElementById("month-select");
    if (!select) return; // por si no existe todavía

    select.innerHTML = "";
    Object.entries(SHEETS).forEach(([key, sheet]) => {
      const opt = document.createElement("option");
      opt.value = key;
      opt.textContent = sheet.label;
      if (key === currentSheetKey) opt.selected = true;
      select.appendChild(opt);
    });

    select.addEventListener("change", () => {
      currentSheetKey = select.value;
      cargarCartelera();
    });
  }

  async function cargarCartelera() {
    const resumen = document.getElementById("count-resumen");
    const contenedor = document.getElementById("assignments");
    if (!resumen || !contenedor) return;

    resumen.textContent = "Cargando…";
    contenedor.innerHTML = "";

    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);

    try {
      const sheet = SHEETS[currentSheetKey];
      if (!sheet) throw new Error("Hoja no configurada");

      const res = await fetch(sheet.url);
      if (!res.ok) throw new Error("HTTP " + res.status);

      const text = await res.text();
      const data = parseCSV(text);

      if (!data || data.length < 2) {
        resumen.textContent = "0 reuniones";
        contenedor.innerHTML = "<p class='empty-msg'>Sin asignaciones cargadas.</p>";
        return;
      }

      // Saltamos encabezado
      const filas = data
        .slice(1)
        .filter(row => row.some(c => c && c.trim() !== ""));

      const reuniones = filas
        .map(row => {
          const fechaTexto = row[0] || "";
          const fechaDate = parseFechaDesdeTexto(fechaTexto);
          return {
            fechaTexto,
            fechaDate,
            // OJO: ajustado a tu orden real de columnas:
            video: row[1] || "",
            audio: row[2] || "",
            mic1: row[3] || "",
            mic2: row[4] || "",
            plataforma: row[5] || "",
            acomEntrada: row[6] || "",
            acomAuditorio: row[7] || ""
          };
        })
        .filter(r => r.fechaDate instanceof Date && !isNaN(r.fechaDate));

      if (!reuniones.length) {
        resumen.textContent = "0 reuniones";
        contenedor.innerHTML = "<p class='empty-msg'>Sin asignaciones válidas.</p>";
        return;
      }

      // Ordenar por fecha
      reuniones.sort((a, b) => a.fechaDate - b.fechaDate);

      // Futuras arriba, pasadas abajo
      const futuras = [];
      const pasadas = [];
      reuniones.forEach(r => {
        if (r.fechaDate < hoy) pasadas.push(r);
        else futuras.push(r);
      });
      const ordenadas = futuras.concat(pasadas);

      contenedor.innerHTML = "";

      ordenadas.forEach((r, index) => {
        const card = document.createElement("article");
        card.className = "assignment-card";
        if (index === 0) card.classList.add("assignment-card-featured");

        // --- Columna de fecha ---
        const fechaDiv = document.createElement("div");
        fechaDiv.className = "assignment-date";

        const daySpan = document.createElement("span");
        daySpan.className = "assignment-day";
        if (esDiaImportante(r.fechaTexto)) daySpan.classList.add("church-day");
        daySpan.textContent = r.fechaTexto || "Sin fecha";

        const labelSpan = document.createElement("span");
        labelSpan.className = "assignment-label";
        labelSpan.textContent = "Reunión";

        const badge = document.createElement("div");
        badge.className = "badge";
        const dot = document.createElement("span");
        dot.className = "badge-dot";
        const txt = document.createElement("span");
        txt.textContent = esDiaImportante(r.fechaTexto)
          ? "Reunión principal"
          : "Reunión de entre semana";
        badge.appendChild(dot);
        badge.appendChild(txt);

        fechaDiv.appendChild(labelSpan);
        fechaDiv.appendChild(daySpan);
        fechaDiv.appendChild(badge);

        // HOY TE TOCA
        if (r.fechaDate.getTime() === hoy.getTime()) {
          const hoyPill = document.createElement("div");
          hoyPill.className = "today-pill";
          hoyPill.textContent = "HOY TE TOCA";
          fechaDiv.appendChild(hoyPill);
        }

        // --- Detalles ---
        const detallesDiv = document.createElement("div");
        detallesDiv.className = "assignment-details";

        function addGrupo(label, value, extraClass) {
          const group = document.createElement("div");
          group.className = "detail-group";

          const l = document.createElement("div");
          l.className = "detail-label";
          if (extraClass) l.classList.add(extraClass);
          l.textContent = label;

          const v = document.createElement("div");
          v.className = "detail-value";
          v.textContent = value || "—";

          group.appendChild(l);
          group.appendChild(v);
          detallesDiv.appendChild(group);
        }

        addGrupo("Audio", r.audio, "label-audio");
        addGrupo("Video", r.video, "label-video");
        addGrupo("Mic 1", r.mic1, "label-mic");
        addGrupo("Mic 2", r.mic2, "label-mic");
        addGrupo("Plataforma", r.plataforma, "label-plataforma");
        addGrupo("Acomodador entrada", r.acomEntrada, "label-entrada");
        addGrupo("Acomodador auditorio", r.acomAuditorio, "label-auditorio");

        card.appendChild(fechaDiv);
        card.appendChild(detallesDiv);
        contenedor.appendChild(card);
      });

      const countText =
        ordenadas.length === 1
          ? "1 reunión asignada"
          : `${ordenadas.length} reuniones asignadas`;
      resumen.textContent = countText;
    } catch (err) {
      console.error("Error cargando la cartelera:", err);
      resumen.textContent = "Error al cargar";
      contenedor.innerHTML =
        "<p class='empty-msg'>Hubo un error al cargar las asignaciones.</p>";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    initMonthSelect();   // llena el selector Mes / año
    cargarCartelera();   // carga la hoja actual
  });
</script>
</body>
</html>