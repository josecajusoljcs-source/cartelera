<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Asignaciones para las reuniones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-strong: #facc15;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: rgba(148, 163, 184, 0.4);
      --radius-xl: 20px;
      --radius-md: 14px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.85);
    }

    * { box-sizing: border-box; margin: 0; padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(56, 189, 248, 0.25), transparent 55%),
        radial-gradient(circle at bottom, rgba(250, 204, 21, 0.18), transparent 55%),
        linear-gradient(135deg, #020617, #020617 40%, #020617);
      color: var(--text);
      padding: 1.1rem;
      display: flex;
      justify-content: center;
    }

    .page { width: 100%; max-width: 980px; }

    header { text-align: center; margin-bottom: 1.1rem; }

    header h1 {
      font-size: clamp(2.0rem, 5vw, 2.6rem);
      letter-spacing: 0.02em;
      font-weight: 800;
      text-shadow: 0 0 22px rgba(15, 23, 42, 0.9);
      line-height: 1.15;
    }

    .pill-bar {
      display: inline-flex; align-items: center; gap: .55rem;
      padding: .35rem .9rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      margin-top: .65rem;
      font-size: .95rem;
      color: var(--muted);
    }
    .pill-dot {
      width: 8px; height: 8px; border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .card-shell {
      background:
        radial-gradient(circle at top left, rgba(148, 163, 184, 0.1), transparent 55%),
        radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.95), #020617);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 1.05rem 1rem 1.15rem;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    .card-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.15), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }
    .card-shell-inner { position: relative; z-index: 1; }

    .section-title {
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom: .6rem; gap:.75rem;
    }
    .section-title h2 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: .18em;
      color: var(--muted);
      font-weight: 700;
    }
    .section-title span {
      font-size: .95rem;
      color: var(--muted);
      padding: .18rem .9rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      white-space: nowrap;
    }

    .assignments-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .assignment-card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.99));
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: .9rem .9rem .85rem;
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 2.1fr);
      gap: .5rem 1.1rem;
      position: relative;
    }

    /* ‚úÖ Pr√≥xima reuni√≥n destacada + sticky real */
    .assignment-card.destacada {
      border-color: rgba(56, 189, 248, 0.95);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.35);
      position: sticky;
      top: .6rem;             /* separadita del borde */
      z-index: 5;
      background: rgba(2, 6, 23, .92);
      backdrop-filter: blur(10px);
    }

    .assignment-date { display:flex; flex-direction:column; gap:.15rem; font-size: 1rem; }

    .assignment-label {
      font-size: .78rem;
      text-transform: uppercase;
      letter-spacing: .15em;
      color: var(--muted);
      font-weight: 700;
    }

    .assignment-day {
      font-size: 1.10rem;
      font-weight: 900;
      color: #f9fafb;
    }
    .assignment-day.church-day { color: var(--accent-strong); }

    .badge-row { display:flex; flex-wrap:wrap; gap:.35rem; margin-top: .25rem; }

    .badge {
      display:inline-flex; align-items:center; gap:.35rem;
      padding: .22rem .85rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.65);
      font-size: .82rem;
      color: var(--muted);
      width: fit-content;
      font-weight: 600;
    }
    .badge-dot {
      width: 9px; height: 9px; border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.9);
    }

    .badge-hoy {
      border-color: #22c55e;
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.22);
      font-weight: 800;
    }
    .badge-hoy .badge-dot {
      background: #22c55e;
      box-shadow: 0 0 12px rgba(22, 163, 74, 0.9);
    }

    .assignment-details {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: .35rem .95rem;
      font-size: 0.95rem;
    }

    .detail-group { display:flex; flex-direction:column; gap:.05rem; }
    .detail-label {
      font-size: .78rem;
      text-transform: uppercase;
      letter-spacing: .13em;
      color: var(--muted);
      position: relative;
      padding-left: 1rem;
      font-weight: 700;
    }
    .detail-label::before {
      content:"";
      position:absolute; left:0; top:50%;
      transform: translateY(-50%);
      width: 7px; height: 7px;
      border-radius: 999px;
      background: var(--muted);
    }

    .detail-label.label-audio::before { background:#38bdf8; }
    .detail-label.label-video::before { background:#a78bfa; }
    .detail-label.label-mic::before { background:#4ade80; }
    .detail-label.label-plataforma::before { background:#facc15; }
    .detail-label.label-entrada::before { background:#fb923c; }
    .detail-label.label-auditorio::before { background:#fb7185; }

    .detail-value {
      font-size: 1.02rem;
      color:#e5e7eb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 650;
    }

    .empty-msg {
      font-size: 1rem;
      color: var(--muted);
      padding: .8rem .2rem 0;
    }

    @media (max-width: 640px) {
      body { padding: .8rem .45rem 1.1rem; }

      header h1 { font-size: 1.85rem; }

      .assignment-card { grid-template-columns: 1fr; }
      .assignment-details { grid-template-columns: 1fr; }

      .detail-label { font-size: .74rem; }
      .detail-value { font-size: 1.02rem; }
    }
  </style>
</head>
<body>
  <main class="page">
    <header>
      <h1>Asignaciones para las reuniones</h1>
      <div class="pill-bar">
        <span class="pill-dot"></span>
        <span>Actualizaci√≥n autom√°tica</span>
      </div>
    </header>

    <section class="card-shell">
      <div class="card-shell-inner">
        <div class="section-title">
          <h2>Pr√≥ximas reuniones</h2>
          <span id="count-resumen">Cargando‚Ä¶</span>
        </div>

        <div id="assignments" class="assignments-grid"></div>
      </div>
    </section>
  </main>

<script>
  // üîß PON√â AC√Å TU CSV PUBLICADO (EL MISMO QUE YA USABAS)
  const CSV_URL =
    "https://docs.google.com/spreadsheets/d/1v0ZUvpB5vE0_e8QL7ZdxXJOsvr6RTrIjBZcjRjdh44E/export?format=csv&gid=96081337";

  function parseCSV(text) {
    const rows = text.trim().split(/\r?\n/);
    return rows.map(r => r.split(","));
  }

  function normalizarTexto(str) {
    return (str || "")
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/,/g, "")
      .trim();
  }

  function parseFechaTexto(fechaTexto) {
    const limpio = normalizarTexto(fechaTexto);
    if (!limpio) return null;

    const meses = {
      enero: 0, febrero: 1, marzo: 2, abril: 3, mayo: 4, junio: 5,
      julio: 6, agosto: 7, septiembre: 8, setiembre: 8, octubre: 9,
      noviembre: 10, diciembre: 11
    };

    // patr√≥n: "... 2 de enero 2026" (a√±o opcional)
    const m = limpio.match(/(\d{1,2})\s+de\s+([a-z√±]+)(?:\s+(\d{4}))?$/i);
    if (!m) return null;

    const dia = parseInt(m[1], 10);
    const mes = meses[m[2]];
    if (isNaN(dia) || mes == null) return null;

    const year = m[3] ? parseInt(m[3], 10) : new Date().getFullYear();
    return new Date(year, mes, dia);
  }

  function esHoy(fechaTexto) {
    const f = parseFechaTexto(fechaTexto);
    if (!f) return false;
    const hoy = new Date();
    const a = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate()).getTime();
    const b = new Date(f.getFullYear(), f.getMonth(), f.getDate()).getTime();
    return a === b;
  }

  function esDiaImportante(fechaTexto) {
    const limpio = normalizarTexto(fechaTexto);
    return limpio.startsWith("domingo") || limpio.startsWith("sabado") || limpio.startsWith("s√°bado");
  }

  async function cargarCartelera() {
    const resumen = document.getElementById("count-resumen");
    const contenedor = document.getElementById("assignments");

    try {
      const res = await fetch(CSV_URL);
      const text = await res.text();
      const data = parseCSV(text);

      if (!data || data.length < 2) {
        resumen.textContent = "0 reuniones";
        contenedor.innerHTML = "<p class='empty-msg'>Sin asignaciones cargadas.</p>";
        return;
      }

      const filas = data.slice(1).filter(r => r.some(c => c && c.trim() !== ""));

      // ‚úÖ ocultar pasadas
      const hoy = new Date();
      const hoySolo = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate()).getTime();

      const futuras = [];
      filas.forEach(row => {
        const fechaTexto = row[0] || "";
        const f = parseFechaTexto(fechaTexto);
        if (!f) return; // si no parsea, la ignoramos para evitar l√≠o
        const solo = new Date(f.getFullYear(), f.getMonth(), f.getDate()).getTime();
        if (solo >= hoySolo) futuras.push({ row, fecha: solo, fechaTexto });
      });

      futuras.sort((a,b) => a.fecha - b.fecha);

      contenedor.innerHTML = "";

      if (futuras.length === 0) {
        resumen.textContent = "0 reuniones";
        contenedor.innerHTML = "<p class='empty-msg'>No hay reuniones futuras cargadas.</p>";
        return;
      }

      resumen.textContent = futuras.length === 1 ? "1 reuni√≥n" : `${futuras.length} reuniones`;

      futuras.forEach((item, index) => {
        const row = item.row;

        const fechaTexto = row[0] || "";
        const video = row[1] || "";
        const audio = row[2] || "";
        const mic1  = row[3] || "";
        const mic2  = row[4] || "";
        const plataforma = row[5] || "";
        const entrada = row[6] || "";
        const auditorio = row[7] || "";

        const card = document.createElement("article");
        card.className = "assignment-card";
        if (index === 0) card.classList.add("destacada");

        const fechaDiv = document.createElement("div");
        fechaDiv.className = "assignment-date";

        const label = document.createElement("span");
        label.className = "assignment-label";
        label.textContent = (index === 0) ? "Pr√≥xima reuni√≥n" : "Reuni√≥n";

        const day = document.createElement("span");
        day.className = "assignment-day";
        if (esDiaImportante(fechaTexto)) day.classList.add("church-day");
        day.textContent = fechaTexto;

        const badges = document.createElement("div");
        badges.className = "badge-row";

        const badgeTipo = document.createElement("div");
        badgeTipo.className = "badge";
        badgeTipo.innerHTML = `<span class="badge-dot"></span><span>${
          esDiaImportante(fechaTexto) ? "Reuni√≥n principal" : "Reuni√≥n de entre semana"
        }</span>`;
        badges.appendChild(badgeTipo);

        if (esHoy(fechaTexto)) {
          const hoyBadge = document.createElement("div");
          hoyBadge.className = "badge badge-hoy";
          hoyBadge.innerHTML = `<span class="badge-dot"></span><span>HOY TE TOCA</span>`;
          badges.appendChild(hoyBadge);
        }

        fechaDiv.appendChild(label);
        fechaDiv.appendChild(day);
        fechaDiv.appendChild(badges);

        const detalles = document.createElement("div");
        detalles.className = "assignment-details";

        function grupo(label, value, cls) {
          const g = document.createElement("div");
          g.className = "detail-group";
          g.innerHTML = `
            <div class="detail-label ${cls || ""}">${label}</div>
            <div class="detail-value">${(value && value.trim()) ? value : "-"}</div>
          `;
          return g;
        }

        detalles.appendChild(grupo("Audio", audio, "label-audio"));
        detalles.appendChild(grupo("Video", video, "label-video"));
        detalles.appendChild(grupo("Mic 1", mic1, "label-mic"));
        detalles.appendChild(grupo("Mic 2", mic2, "label-mic"));
        detalles.appendChild(grupo("Plataforma", plataforma, "label-plataforma"));
        detalles.appendChild(grupo("Acomodador entrada", entrada, "label-entrada"));
        detalles.appendChild(grupo("Acomodador auditorio", auditorio, "label-auditorio"));

        card.appendChild(fechaDiv);
        card.appendChild(detalles);
        contenedor.appendChild(card);
      });

    } catch (e) {
      console.error(e);
      resumen.textContent = "Error";
      contenedor.innerHTML = "<p class='empty-msg'>Hubo un error al cargar.</p>";
    }
  }

  cargarCartelera();
</script>
</body>
</html>